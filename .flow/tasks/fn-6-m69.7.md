# fn-6-m69.7 Integration tests for full CRUD flows & documentation updates

## Description
Write integration tests for full CRUD flows and update project documentation.

**Files to create:**
- `tests/integration/test_crud_flows.py` — E2E tests with mocked Google Calendar API and mocked Gemini responses. Test scenarios:
  1. Create-only flow (baseline, existing behavior)
  2. Update flow: calendar has event, conversation references it, AI outputs update action with existing_event_id
  3. Delete flow: calendar has event, conversation cancels it, AI outputs delete with existing_event_id
  4. Mixed flow: single conversation produces create + update + delete
  5. Fallback: update with 404 falls back to create
  6. No-context graceful degradation: credentials fail, extraction proceeds without calendar context

**Files to modify:**
- `CLAUDE.md` — Update architecture section with new calendar context flow, mention CRUD intelligence.
- `docs/SPEC.md` — Update pipeline description with new Stage 1.5 (context fetch).

**Key test patterns:**
- Follow existing test patterns in `tests/integration/test_end_to_end.py`.
- Mock both `GoogleCalendarClient` (for context fetch + sync) and `GeminiClient` (for extraction).
- Use `_patch_pipeline_deps` helper pattern from `tests/unit/test_pipeline.py`.
- Verify correct dispatch: update_event called with real event ID, delete_event called with real event ID.
## Acceptance
- [ ] At least 6 integration tests covering all CRUD flow scenarios
- [ ] Tests verify correct API method dispatch (create/update/delete)
- [ ] Tests verify 404 fallback behavior
- [ ] Tests verify graceful degradation without calendar context
- [ ] CLAUDE.md updated with CRUD intelligence description
- [ ] docs/SPEC.md updated with new pipeline flow
- [ ] All tests pass (unit + integration)
- [ ] Coverage maintained at ≥90%
- [ ] ruff clean
## Done summary
Added 8 integration tests covering all CRUD flow scenarios (create-only, update/delete with existing_event_id, mixed CRUD, 404 fallback, graceful degradation, search-based fallback). Updated CLAUDE.md with CRUD intelligence architecture and docs/SPEC.md with Stage 1.5 pipeline description.
## Evidence
- Commits: c1b370e49e556ed1b488195d4382757ee8435a4f
- Tests: python3 -m pytest --tb=short -q (313 passed, 92% coverage), python3 -m ruff check . (clean)
- PRs: